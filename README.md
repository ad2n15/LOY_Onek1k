# LOY_OneK1K

This repository contains the complete pipeline used to identify and analyze mosaic loss of chromosome Y (LOY) in immune cells using single-cell RNA-seq data from the OneK1K study.

---

## üî¨ Project Overview

LOY is the most frequent somatic event in aging men and has been associated with increased risk for multiple age-related diseases. In this study, we utilized single-cell transcriptomic data (scRNA-seq) and SNP arrays genotyping to identify LOY at cellular resolution and explore its effects on immune cell phenotypes and gene expression programs.

## üìÇ Automatically Generated Repository Structure

You can view the current structure of the repository at any time by running:

```bash
tree -a -I '.git|__pycache__|.ipynb_checkpoints'
```

This command will display the directory tree, excluding common hidden/system folders. For example:

```
.
‚îú‚îÄ‚îÄ make_container/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ scripts_for_processing_LOY_scRNA-seq_calls/
‚îÇ   ‚îú‚îÄ‚îÄ process_monocytes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ step1.R
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ step2.R
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ step3.R
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ step4.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ step5.R
‚îÇ   ‚îú‚îÄ‚îÄ process_CD4T_cells/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ scripts_for_count_and_demultiplex_cellranger_step/
‚îÇ   ‚îú‚îÄ‚îÄ demuliplex_bam_file.sh
‚îÇ   ‚îú‚îÄ‚îÄ run_cellranger.sh
‚îÇ   ‚îî‚îÄ‚îÄ subset_expression_by_indv.sh
‚îú‚îÄ‚îÄ scripts_for_calling_LOY_from_scRNA-seq/
‚îÇ   ‚îú‚îÄ‚îÄ run_detect_LOY_genes_cellranger.py
‚îÇ   ‚îî‚îÄ‚îÄ run_detect_LOY_genes_velocyto.py
‚îú‚îÄ‚îÄ scripts_for_preparing_scRNA-seq_LOY_calls/
‚îÇ   ‚îú‚îÄ‚îÄ merge_cellranger_velocyto_LOY_calls.py
‚îÇ   ‚îî‚îÄ‚îÄ merge_rds_barcode.py
‚îú‚îÄ‚îÄ scripts_for_calling_mCA_from_SNParrays/
‚îÇ   ‚îú‚îÄ‚îÄ step_1_idat_to_gtc.sh
‚îÇ   ‚îú‚îÄ‚îÄ step_2_gtc_to_vcf.sh
‚îÇ   ‚îú‚îÄ‚îÄ step_3_annotate_vcf.sh
‚îÇ   ‚îú‚îÄ‚îÄ step_4_filter.sh
‚îÇ   ‚îú‚îÄ‚îÄ step_5_extract_genotypes.sh
‚îÇ   ‚îú‚îÄ‚îÄ step_6_phase_vcf.sh
‚îÇ   ‚îú‚îÄ‚îÄ step_7_call_mca.sh
‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ step_1_count_and_demultiplex_cellranger.sh
‚îú‚îÄ‚îÄ step_2_count_velocyto.sh
‚îú‚îÄ‚îÄ step_3a_call_LOY_cellranger.sh
‚îú‚îÄ‚îÄ step_3b_call_LOY_velocyto.sh
‚îú‚îÄ‚îÄ step_4_merge_cellranger_velocyto_LOY_calls.sh
‚îú‚îÄ‚îÄ step_5_process_barcodes_to_match_rds_file.sh
‚îú‚îÄ‚îÄ step_6_prepare_and_collect_all_LOY_calls.sh
‚îî‚îÄ‚îÄ README.md
```

> **Tip:** Run `tree -L 2` for a more compact overview, or adjust the depth as needed.


## üõ†Ô∏è Required Packages & Tools

All analyses were performed using Apptainer containers on an HPC environment to ensure reproducibility.

### Processing scRNA-seq Reads & LOY Calling

- **Cell Ranger**: [10x Genomics Cell Ranger](https://www.10xgenomics.com/support/software/cell-ranger/downloads) ‚Äî for read alignment, quantification, and initial LOY calling.  
- **subset-bam**: [10x Genomics subset-bam](https://github.com/10XGenomics/subset-bam) ‚Äî for extracting specific cell barcodes from BAM files.  
- **Velocyto**: [genomicpariscentre/velocyto (Docker)](https://hub.docker.com/r/genomicpariscentre/velocyto) ‚Äî for spliced/unspliced read counting.
- **Python 3**: [jupyter/datascience-notebook (Docker)](https://hub.docker.com/r/jupyter/datascience-notebook/) ‚Äî for running Python scripts and analyses.

### Processing SNP Array Data & LOY Calling

- **BCFtools** ‚Äî for variant calling and manipulation.
- **MoChA**: [MoChA](https://github.com/freeseek/mocha) ‚Äî for detecting mosaic chromosomal alterations from SNP array data.
- **gtc2vcf**: [gtc2vcf](https://github.com/freeseek/gtc2vcf) ‚Äî for converting Illumina GTC files to VCF format.

### Downstream scRNA-seq Analysis

- **Custom Seurat v4 Container** ‚Äî available in the `make_container` folder, includes Seurat v4 and supporting R packages.
- **Seurat v5 (MAST DGE)**: [satijalab/seurat (Docker)](https://hub.docker.com/r/satijalab/seurat) ‚Äî for differential gene expression analysis using the MAST method.
- **phate**: [phate (PyPI)](https://pypi.org/project/phate/) ‚Äî for dimensionality reduction and visualization in Python.

---


---

## üìÅ Repository Structure

| Folder/File | Description |
|-------------|-------------|
| `call_mCA_from_SNParrays/` | Bash scripts for calling mosaic chromosomal alterations (mCA) from SNP array data. |
| `mapping_and_counting/` | Bash scripts and annotations for initial mapping and gene counting steps. |
| `script/` | Miscellaneous annotated R and python scripts used throughout the pipeline. |
| `step_1_count_and_demultiplex_cellranger.sh` | read count processing using Cell Ranger, and demultiplex |
| `step_2_count_velocyto.sh` | Running Velocyto to count spliced/unspliced reads on BAM files generated by CellRanger. |
| `step_3a_call_LOY_cellranger.sh` | Identify LOY cells using Cell Ranger output. |
| `step_3b_call_LOY_velocyto.sh` | Identify LOY cells using Velocyto output. |
| `step_4_merge_cellranger_velocyto_LOY_calls.sh` | Merge LOY calls from Cell Ranger and Velocyto. |
| `step_5_process_barcodes_to_match_rds_file.sh` | Align LOY calls with metadata from Seurat RDS object obtained from CellxGene database. |
| `step_6_prepare_and_collect_all_LOY_calls.sh` | Aggregate LOY calls and prepare for analysis. |
| `README.md` | This file. |

---

## üìä Interactive Results Portal

Explore LOY patterns by donor, cell type, and gene expression using our Shiny app:

üëâ https://lagreen.shinyapps.io/1k1kloy/

---


